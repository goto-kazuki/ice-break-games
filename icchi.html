<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>ã¿ã‚“ãªã§ä¸€è‡´ã‚²ãƒ¼ãƒ  - ã‚¢ã‚¤ã‚¹ãƒ–ãƒ¬ã‚¤ã‚¯ã‚²ãƒ¼ãƒ ã²ã‚ã°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --main-color: #66CCFF;
      --main-dark: #4DB8EB;
      --accent-color: #FFC107;
      --sub-accent: #333366;
      --bg-light: #F0F8FF;
      --text-main: #333333;
      --text-sub: #666666;
      --shadow-card: 0 10px 25px rgba(102, 204, 255, 0.15);
    }
    
    * { box-sizing: border-box; }
    
    body {
      margin: 0;
      font-family: 'M PLUS Rounded 1c', sans-serif;
      background-color: var(--bg-light);
      color: var(--text-main);
      line-height: 1.6;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ */
    header {
      background: linear-gradient(135deg, #fff 0%, var(--bg-light) 100%);
      padding: 30px 20px;
      text-align: center;
      border-bottom: 4px solid var(--main-color);
      border-bottom-left-radius: 40px;
      border-bottom-right-radius: 40px;
      margin-bottom: 40px;
    }

    .header-icon {
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin-bottom: 10px;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
    }

    h1 {
      margin: 10px 0;
      color: var(--sub-accent);
      font-weight: 900;
      font-size: 1.8rem;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      text-decoration: none;
      color: var(--sub-accent);
      font-weight: 700;
      padding: 8px 16px;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      transition: transform 0.2s;
    }
    .back-link:hover { transform: translateY(-2px); }

    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
    main { max-width: 800px; margin: 0 auto; padding: 0 20px 60px; }

    .panel {
      background: #fff;
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: var(--shadow-card);
    }

    .panel h2 {
      margin: 0 0 20px;
      font-size: 1.3rem;
      color: var(--sub-accent);
      border-left: 6px solid var(--accent-color);
      padding-left: 12px;
      display: flex;
      align-items: center;
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */
    label { display: block; font-weight: 700; margin-bottom: 8px; color: var(--sub-accent); }
    
    input[type="number"], input[type="text"] {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: 2px solid #eee;
      background: #fafafa;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    input:focus { outline: none; border-color: var(--main-color); background: #fff; }

    /* ãƒœã‚¿ãƒ³ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 14px 28px;
      border-radius: 50px;
      border: none;
      cursor: pointer;
      font-weight: 900;
      font-size: 1rem;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #FFC107 0%, #FFD54F 100%);
      color: #333;
      box-shadow: 0 4px 0 #DDA000, 0 8px 15px rgba(255, 193, 7, 0.3);
    }
    .btn-primary:hover { transform: translateY(2px); box-shadow: 0 2px 0 #DDA000; }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; box-shadow: none; transform: none; background: #ddd; color: #888; }

    .btn-secondary {
      background: #fff;
      color: var(--main-color);
      border: 2px solid var(--main-color);
    }
    .btn-secondary:hover { background: var(--main-color); color: #fff; }

    /* ã‚²ãƒ¼ãƒ å›ºæœ‰ã‚¨ãƒªã‚¢ */
    .topic-card {
      padding: 30px;
      border-radius: 20px;
      background: #FFF8E1;
      border: 3px dashed var(--accent-color);
      text-align: center;
      margin-top: 20px;
    }
    .topic-label { color: #d48806; font-weight: 700; margin-bottom: 10px; }
    .topic-main { font-size: 1.6rem; font-weight: 900; color: var(--sub-accent); margin-bottom: 10px; }
    .topic-detail { font-size: 1rem; color: #666; }

    .answers-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 15px;
      background: #f9f9f9;
      padding: 10px;
      border-radius: 12px;
    }
    .answers-row label { margin: 0; min-width: 120px; }
    
    .locked-badge {
      background: #E8F5E9;
      color: #2E7D32;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 700;
    }

    ul#player-list { padding-left: 20px; color: var(--text-sub); }
    ul#player-list li { margin-bottom: 6px; font-weight: 700; }

    /* ãƒ•ãƒƒã‚¿ãƒ¼ */
    footer {
      text-align: center;
      padding: 40px 20px;
      color: #999;
      font-size: 0.85rem;
      background: var(--sub-accent);
    }
    .footer-logo {
      width: 100px;
      margin-bottom: 10px;
      border-radius: 12px;
    }

    @media (max-width: 600px) {
      .answers-row { flex-direction: column; align-items: stretch; text-align: left; }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <a href="menu.html" class="back-link">â—€ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>
      <br>
      <img src="icchi.png" alt="ã‚¢ã‚¤ã‚³ãƒ³" class="header-icon">
      <h1>ã¿ã‚“ãªã§ä¸€è‡´ã‚²ãƒ¼ãƒ </h1>
      <p style="color: var(--text-sub); font-weight: 700;">å›ç­”ä¸€è‡´ã§ç››ã‚Šä¸ŠãŒã‚‹ï¼</p>
    </div>
  </header>

  <main>
    <!-- ãƒ«ãƒ¼ãƒ« -->
    <section class="panel">
      <h2>ğŸ“Œ ã“ã®ã‚²ãƒ¼ãƒ ã«ã¤ã„ã¦</h2>
      <p>ãŠé¡Œã«å¯¾ã™ã‚‹å›ç­”ãŒå…¨å“¡ä¸€è‡´ã™ã‚‹ã¾ã§ç¹°ã‚Šè¿”ã™ã‚²ãƒ¼ãƒ ã€‚ä¸€è‡´ã—ãªãã¦ã‚‚ã€Œãªãœãã†æ€ã£ãŸï¼Ÿã€ã§ä¼šè©±ãŒåºƒãŒã‚Šã€ä¾¡å€¤è¦³ã®å…±æœ‰ã«ã¤ãªãŒã‚Šã¾ã™ã€‚</p>
      <p style="margin-top:15px; background:#FFF8E1; padding:10px; border-radius:10px;">
        <strong>ãŠé¡Œä¾‹ï¼š</strong>ã€Œæœä¸€ç•ªã«é£²ã¿ãŸã„ãƒ‰ãƒªãƒ³ã‚¯ã€ã€Œã‚¹ãƒˆãƒ¬ã‚¹è§£æ¶ˆæ³•ã€ã€Œä¼‘æ—¥ã«ã—ãŸã„ã“ã¨ã€
      </p>
    </section>

    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­å®š -->
    <section class="panel">
      <h2>â‘  äººæ•°ã¨ã‚ã åã‚’ç™»éŒ²</h2>
      <div style="display:flex; gap:15px; flex-wrap:wrap; align-items:flex-end; margin-bottom:15px;">
        <div style="flex:1; min-width:140px;">
          <label for="player-count">äººæ•°ï¼ˆ2ã€œ12ï¼‰</label>
          <input type="number" id="player-count" min="2" max="12" value="4" />
        </div>
        <div>
          <button class="btn btn-primary" id="init-players-btn">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ ã‚’ä½œã‚‹</button>
        </div>
      </div>
      <p style="color:var(--text-sub); font-size:0.9rem;" id="player-setup-status">ã¾ã ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ ã¯ä½œã‚‰ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>

      <div id="nickname-area" style="display:none; margin-top:20px; padding:20px; background:#F0F8FF; border-radius:15px;">
        <label for="nickname-input">ã‚ã åã‚’å…¥åŠ›</label>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <input type="text" id="nickname-input" placeholder="ä¾‹ï¼šã—ã‚‚ã—ã‚…ã‚“" style="flex:1;" />
          <button class="btn btn-secondary" id="add-nickname-btn">ç™»éŒ²</button>
        </div>
      </div>

      <ul id="player-list" style="margin-top:20px;"></ul>
    </section>

    <!-- ãŠé¡Œ -->
    <section class="panel">
      <h2>â‘¡ ãŠé¡Œã‚’æ±ºã‚ã‚‹</h2>
      <div style="text-align:center;">
        <button class="btn btn-primary" id="random-topic-btn">ãŠé¡Œã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«è¡¨ç¤º</button>
        <button class="btn btn-secondary" id="change-topic-btn" style="display:none; margin-left:10px;">åˆ¥ã®ãŠé¡Œã«ã™ã‚‹</button>
      </div>

      <div class="topic-card" id="topic-card" style="display:none;">
        <div class="topic-label" id="topic-category"></div>
        <div class="topic-main" id="topic-main"></div>
        <div class="topic-detail" id="topic-detail"></div>
      </div>
    </section>

    <!-- å›ç­”å…¥åŠ› -->
    <section class="panel">
      <h2>â‘¢ å…¨å“¡ãŒå›ç­”ã‚’å…¥åŠ›</h2>
      <p style="color:var(--text-sub); font-size:0.9rem; margin-bottom:20px;">
        â€» å„è‡ªã®ç«¯æœ«ã§å…¥åŠ›ã™ã‚‹ã‹ã€1ã¤ã®ç«¯æœ«ã‚’å›ã—ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>
        â€» å…¥åŠ›å¾Œã€Œãƒ­ãƒƒã‚¯ã€ãƒœã‚¿ãƒ³ã§å›ç­”ã‚’éš ã—ã¾ã™ã€‚
      </p>

      <div id="answers-area" style="display:none;">
        <div id="inputs-area"></div>

        <div style="text-align:center; margin-top:30px;">
          <button class="btn btn-primary" id="submit-answers-btn" disabled>å…¨å“¡ã®å›ç­”ã‚’å…¬é–‹ã™ã‚‹ï¼</button>
        </div>
      </div>
    </section>

    <!-- çµæœ -->
    <section class="panel" id="result-panel" style="display:none;">
      <h2>çµæœç™ºè¡¨</h2>
      <div id="result-content" style="margin-bottom:20px;"></div>

      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
        <button class="btn btn-primary" id="retry-btn" style="display:none;">ã‚‚ã†ä¸€åº¦ï¼ˆåŒã˜ãŠé¡Œï¼‰</button>
        <button class="btn btn-secondary" id="new-topic-btn" style="display:none;">æ¬¡ã®ãŠé¡Œã¸</button>
      </div>
    </section>
  </main>

  <footer>
    <img src="team-logo.png" alt="BigStone ãƒãƒ¼ãƒ ãƒ­ã‚´" class="footer-logo">
    <div style="color:#fff;">Â© 2025 ã‚¢ã‚¤ã‚¹ãƒ–ãƒ¬ã‚¤ã‚¯ã‚²ãƒ¼ãƒ ã²ã‚ã° | BigStone</div>
  </footer>

  <script>
    const topics = [
      { category:"é£Ÿã¹ç‰©", main: "å¥½ããªãŠã‚„ã¤", detail: "ä¾‹ï¼šãƒãƒ§ã‚³ / ãƒãƒ†ãƒ / ã‚¬ãƒ " },
      { category:"é£²ã¿ç‰©", main: "æœä¸€ç•ªã«é£²ã¿ãŸã„ãƒ‰ãƒªãƒ³ã‚¯", detail: "ä¾‹ï¼šã‚³ãƒ¼ãƒ’ãƒ¼ / ç·‘èŒ¶ / ç‰›ä¹³" },
      { category:"å­£ç¯€", main: "å¥½ããªå­£ç¯€ã®ã‚¤ãƒ™ãƒ³ãƒˆ", detail: "ä¾‹ï¼šèŠ±è¦‹ / æµ· / ç´…è‘‰" },
      { category:"ä¼‘æ—¥", main: "ä¼‘æ—¥ã«ã—ãŸã„ã“ã¨", detail: "ä¾‹ï¼šæ•£æ­© / æ˜ ç”» / èª­æ›¸" },
      { category:"æ—…è¡Œ", main: "è¡Œã£ã¦ã¿ãŸã„å›½å†…ã®å ´æ‰€", detail: "ä¾‹ï¼šäº¬éƒ½ / æ²–ç¸„ / åŒ—æµ·é“" },
      { category:"æ°—åˆ†", main: "ä»Šã®æ°—åˆ†ã‚’è¡¨ã™è‰²", detail: "ä¾‹ï¼šé’ / ãƒ”ãƒ³ã‚¯ / é»„è‰²" },
      { category:"é£Ÿäº‹", main: "ç–²ã‚ŒãŸã¨ãã«é£Ÿã¹ãŸã„ã‚‚ã®", detail: "ä¾‹ï¼šã‚«ãƒ¬ãƒ¼ / ãƒ©ãƒ¼ãƒ¡ãƒ³ / ãŠã«ãã‚Š" },
      { category:"éŸ³æ¥½", main: "ã‚ˆãè´ãéŸ³æ¥½ã‚¸ãƒ£ãƒ³ãƒ«", detail: "ä¾‹ï¼šJ-POP / ãƒ­ãƒƒã‚¯ / ã‚¢ãƒ‹ã‚½ãƒ³" },
      { category:"æ˜ ç”»", main: "å¥½ããªæ˜ ç”»ã‚¸ãƒ£ãƒ³ãƒ«", detail: "ä¾‹ï¼šã‚¢ãƒ‹ãƒ¡ / ã‚³ãƒ¡ãƒ‡ã‚£ / ã‚µã‚¹ãƒšãƒ³ã‚¹" },
      { category:"å‹•ç‰©", main: "é£¼ã„ãŸã„å‹•ç‰©", detail: "ä¾‹ï¼šçŠ¬ / çŒ« / é³¥" },
      { category:"ç”Ÿæ´»", main: "æœå‹ã‹å¤œå‹ã‹", detail: "ä¾‹ï¼šæœå‹ / å¤œå‹" },
      { category:"å¥½ã¿", main: "ç”˜ã„ã‚‚ã®vsã—ã‚‡ã£ã±ã„ã‚‚ã®", detail: "ä¾‹ï¼šç”˜ã„ / ã—ã‚‡ã£ã±ã„" },
      { category:"è²·ã„ç‰©", main: "ã‚³ãƒ³ãƒ“ãƒ‹ã§ã‚ˆãè²·ã†ã‚‚ã®", detail: "ä¾‹ï¼šãŠã«ãã‚Š / ã‚µãƒ³ãƒ‰ / ãƒ‰ãƒªãƒ³ã‚¯" },
      { category:"ä½“é¨“", main: "ã‚„ã£ã¦ã¿ãŸã„ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£", detail: "ä¾‹ï¼šã‚¹ã‚­ãƒ¥ãƒ¼ãƒ / æ¸©æ³‰ / ç™»å±±" },
      { category:"æ„Ÿè¦š", main: "å¥½ããªåŒ‚ã„ï¼ˆçŸ­ãï¼‰", detail: "ä¾‹ï¼šã‚³ãƒ¼ãƒ’ãƒ¼ / ç·‘èŒ¶ / èŠ±" },
      { category:"ç†æƒ³", main: "ç†æƒ³ã®é€±æœ«ã®éã”ã—æ–¹", detail: "ä¾‹ï¼šã®ã‚“ã³ã‚Š / å¤–å‡º / ä¼šé£Ÿ" },
      { category:"å­¦ç¿’", main: "ä»Šå­¦ã³ãŸã„ã“ã¨", detail: "ä¾‹ï¼šè‹±èª / æ–™ç† / ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°" },
      { category:"æœé£Ÿ", main: "æœé£Ÿã«é£Ÿã¹ãŸã„ã‚‚ã®", detail: "ä¾‹ï¼šãƒ‘ãƒ³ / ã”ã¯ã‚“ / ã‚·ãƒªã‚¢ãƒ«" },
      { category:"æ€ã„å‡º", main: "å­ã©ã‚‚ã®é ƒã®éŠã³", detail: "ä¾‹ï¼šå…¬åœ’ / ã‚²ãƒ¼ãƒ  / çµµæœ¬" },
      { category:"å¥åº·", main: "ã‚¹ãƒˆãƒ¬ã‚¹è§£æ¶ˆæ³•ï¼ˆçŸ­ãï¼‰", detail: "ä¾‹ï¼šå¯ã‚‹ / é‹å‹• / é£Ÿã¹ã‚‹" }
    ];

    let players = [];
    let targetCount = 0;

    const playerCountInput = document.getElementById("player-count");
    const initPlayersBtn = document.getElementById("init-players-btn");
    const playerSetupStatusEl = document.getElementById("player-setup-status");
    const nicknameAreaEl = document.getElementById("nickname-area");
    const nicknameInput = document.getElementById("nickname-input");
    const addNicknameBtn = document.getElementById("add-nickname-btn");
    const playerListEl = document.getElementById("player-list");
    const randomTopicBtn = document.getElementById("random-topic-btn");
    const changeTopicBtn = document.getElementById("change-topic-btn");
    const topicCardEl = document.getElementById("topic-card");
    const topicCategoryEl = document.getElementById("topic-category");
    const topicMainEl = document.getElementById("topic-main");
    const topicDetailEl = document.getElementById("topic-detail");
    const answersArea = document.getElementById("answers-area");
    const inputsArea = document.getElementById("inputs-area");
    const submitAnswersBtn = document.getElementById("submit-answers-btn");
    const resultPanel = document.getElementById("result-panel");
    const resultContent = document.getElementById("result-content");
    const retryBtn = document.getElementById("retry-btn");
    const newTopicBtn = document.getElementById("new-topic-btn");

    initPlayersBtn.addEventListener("click", () => {
      const count = Number(playerCountInput.value);
      if (Number.isNaN(count) || count < 2) { alert("2äººä»¥ä¸Šã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚"); return; }
      if (count > 12) { alert("æœ€å¤§12äººã¾ã§æ¨å¥¨ã—ã¾ã™ã€‚"); return; }
      targetCount = count; players = []; playerListEl.innerHTML = ""; inputsArea.innerHTML = "";
      answersArea.style.display = "none"; resultPanel.style.display = "none"; topicCardEl.style.display = "none";
      nicknameAreaEl.style.display = "block";
      playerSetupStatusEl.textContent = `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ ã‚’ ${targetCount} äººåˆ†ç”¨æ„ã—ã¾ã—ãŸã€‚é †ã«ã‚ã åã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚`;
      submitAnswersBtn.disabled = true;
    });

    addNicknameBtn.addEventListener("click", () => {
      if (players.length >= targetCount) { alert("ã™ã§ã«å…¨å“¡åˆ†ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚"); return; }
      const nickname = nicknameInput.value.trim();
      if (!nickname) { alert("ã‚ã åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"); return; }
      if (players.some(p => p.nickname === nickname)) { alert("åŒã˜ã‚ã åã¯ä½¿ãˆã¾ã›ã‚“ã€‚"); return; }
      players.push({ nickname, answer: "", locked: false });
      const li = document.createElement("li");
      li.textContent = `${players.length}. ${nickname}`;
      playerListEl.appendChild(li);
      nicknameInput.value = "";
      if (players.length === targetCount) {
        playerSetupStatusEl.textContent = `å…¨å“¡ç™»éŒ²å®Œäº†ï¼ˆ${targetCount}äººï¼‰ã€‚æ¬¡ã«ãŠé¡Œã‚’æ±ºã‚ã¦ãã ã•ã„ã€‚`;
        nicknameAreaEl.style.display = "none";
      } else {
        playerSetupStatusEl.textContent = `ç™»éŒ²æ¸ˆã¿ï¼š${players.length} / ${targetCount} äºº`;
      }
    });

    function showRandomTopic() {
      const idx = Math.floor(Math.random() * topics.length);
      const t = topics[idx];
      topicCategoryEl.textContent = `ã‚«ãƒ†ã‚´ãƒªï¼š${t.category}`;
      topicMainEl.textContent = t.main;
      topicDetailEl.textContent = t.detail;
      topicCardEl.style.display = "block";
      changeTopicBtn.style.display = "inline-block";
      if (players.length === targetCount && targetCount > 0) prepareAnswersInputs();
      else answersArea.style.display = "none";
      resultPanel.style.display = "none";
    }
    randomTopicBtn.addEventListener("click", showRandomTopic);
    changeTopicBtn.addEventListener("click", showRandomTopic);

    function prepareAnswersInputs() {
      players.forEach(p => { p.answer = ""; p.locked = false; });
      inputsArea.innerHTML = "";
      players.forEach((p, i) => {
        const wrap = document.createElement("div"); wrap.className = "answers-row";
        const label = document.createElement("label"); label.textContent = `${i + 1}. ${p.nickname}`;
        const input = document.createElement("input"); input.type = "text"; input.placeholder = "å›ç­”ã‚’å…¥åŠ›"; input.dataset.idx = i;
        input.addEventListener("keydown", (e) => { if (e.key === "Enter") { e.preventDefault(); lockAnswer(i, input, lockBtn, wrap); }});
        const lockBtn = document.createElement("button"); lockBtn.className = "btn btn-secondary"; lockBtn.textContent = "ãƒ­ãƒƒã‚¯";
        lockBtn.style.padding = "8px 16px"; lockBtn.style.fontSize = "0.9rem";
        lockBtn.addEventListener("click", () => lockAnswer(i, input, lockBtn, wrap));
        wrap.appendChild(label); wrap.appendChild(input); wrap.appendChild(lockBtn);
        inputsArea.appendChild(wrap);
      });
      answersArea.style.display = "block";
      submitAnswersBtn.disabled = true;
      resultPanel.style.display = "none";
    }

    function lockAnswer(index, inputEl, lockBtn, wrapEl) {
      if (players[index].locked) return;
      const val = (inputEl.value || "").trim();
      if (!val) { alert("å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"); return; }
      players[index].answer = val;
      players[index].locked = true;
      inputEl.remove(); lockBtn.remove();
      const statusSpan = document.createElement("span"); statusSpan.className = "locked-badge"; statusSpan.textContent = "ãƒ­ãƒƒã‚¯æ¸ˆï¼ˆéè¡¨ç¤ºï¼‰";
      wrapEl.appendChild(statusSpan);
      const checkLocked = players.length > 0 && players.every(p => p.locked);
      submitAnswersBtn.disabled = !checkLocked;
    }

    submitAnswersBtn.addEventListener("click", () => {
      const normalized = players.map(p => normalizeAnswer(p.answer));
      const first = normalized[0];
      const allMatch = normalized.every(a => a === first);
      let html = '<div style="display:flex;flex-direction:column;gap:10px">';
      players.forEach((p) => {
        html += `<div style="background:#fff;border-bottom:1px solid #eee;padding:10px;display:flex;justify-content:space-between;"><strong>${escapeHtml(p.nickname)}</strong><span>${escapeHtml(p.answer)}</span></div>`;
      });
      html += '</div>';

      if (allMatch) {
        resultContent.innerHTML = `<div style="font-size:1.5rem;color:#E91E63;font-weight:900;margin-bottom:10px;text-align:center;">ğŸ‰ å…¨å“¡ä¸€è‡´ï¼å¤§æˆåŠŸï¼ ğŸ‰</div>` + html;
      } else {
        resultContent.innerHTML = `<div style="font-size:1.2rem;color:var(--sub-accent);font-weight:900;margin-bottom:10px;text-align:center;">æ®‹å¿µï¼ä¸€è‡´ãªã‚‰ãšâ€¦</div>` + html;
      }
      retryBtn.style.display = 'inline-flex'; newTopicBtn.style.display = 'inline-flex';
      resultPanel.style.display = 'block';
    });

    retryBtn.addEventListener("click", () => {
      players.forEach(p => { p.answer = ''; p.locked = false; });
      prepareAnswersInputs();
      resultPanel.style.display = "none";
    });
    newTopicBtn.addEventListener("click", showRandomTopic);

    function normalizeAnswer(s){ if(!s)return ''; return String(s).trim().toLowerCase(); }
    function escapeHtml(s){ if(s==null)return ''; return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
  </script>
</body>
</html>